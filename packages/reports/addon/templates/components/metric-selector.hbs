{{!-- Copyright 2019, Yahoo Holdings Inc. Licensed under the terms of the MIT license. See accompanying LICENSE.md file for terms. --}}
{{#navi-list-selector
   items=allMetrics
   searchField="longName"
   selected=selectedMetrics
   title="Metrics"
   as | metrics areMetricsFiltered |
}}
  {{#grouped-list
    items=metrics
    shouldOpenAllGroups=areMetricsFiltered
    groupByField="category"
    sortByField=(unless areMetricsFiltered "longName")
    as | metric |
  }}
    <div class="grouped-list__item-container {{if (and (get metricsChecked metric.name) enableRequestPreview) "grouped-list__item-container--selected"}}">
      <NaviIcon
        @icon={{if (and (get metricsChecked metric.name) (not enableRequestPreview)) "minus-circle" "plus-circle"}}
        class="grouped-list__add-icon {{if (not (or enableRequestPreview (get metricsChecked metric.name))) "grouped-list__add-icon--deselected"}}"
        onclick={{action "metricClicked" metric}} />
      {{metric.longName}}

      {{#navi-icon "question-circle-o" class="grouped-list__item-info"}}
        {{#ember-tooltip side="right" popperContainer="body" effect="none"}}
          {{#if metric.extended.isPending}}
            {{navi-loading-message}}
          {{else}}
            {{or metric.extended.content.description "No description available"}}
          {{/if}}
        {{/ember-tooltip}}
      {{/navi-icon}}

      <div class="grouped-list__icon-set {{if (not (can-having metric)) "metric-selector__icon-set--no-filter"}}">
        {{#if (get metric "hasParameters")}}
          {{metric-config
            metric=metric
            request=request
            onAddParameterizedMetric=(update-report-action "ADD_METRIC_WITH_PARAM")
            onRemoveParameterizedMetric=(update-report-action "REMOVE_METRIC_WITH_PARAM")
            onToggleParameterizedMetricFilter=(update-report-action "TOGGLE_PARAMETERIZED_METRIC_FILTER")
          }}
        {{/if}}
        {{#if (can-having metric)}}
          <a role="button"
            class={{concat (if (get metricsFiltered metric.name) "grouped-list__filter--active ") "grouped-list__filter"}}
            onclick={{action onToggleMetricFilter metric}}>
            <span></span>
            {{#ember-tooltip side="right" popperContainer="body" effect="none"}}
              {{#if (has-parameters metric)}}
                {{#if (has-unfiltered-parameters metric request)}}
                  Add next filter
                {{else}}
                  Remove all
                {{/if}}
              {{else}}
                {{#if (get metricsFiltered metric.name)}}
                  Remove Filter
                {{else}}
                  Add Filter
                {{/if}}
              {{/if}}
            {{/ember-tooltip}}
          </a>
        {{/if}}
      </div>
    </div>
  {{/grouped-list}}
{{/navi-list-selector}}
