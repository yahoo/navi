{{!-- Copyright 2021, Yahoo Holdings Inc. Licensed under the terms of the MIT license. See accompanying LICENSE.md file for terms. --}}
<div class="report-builder-sidebar column">
  <div class="report-builder-sidebar__header row p-y-7 align-items-center">
    {{#if (gt this.sourcePath.length 0)}}
      <DenaliButton
        class="report-builder-sidebar__back m-l-5"
        disabled={{@disabled}}
        @iconOnly={{true}}
        @style="text"
        {{on "click" this.goBack}}
      >
        <DenaliIcon class="is-brand-300" @icon="arrowhead-left" />
      </DenaliButton>
    {{/if}}
    <div>
      <DenaliBreadcrumb class="report-builder-sidebar__breadcrumb flex-1 font-12" @items={{this.breadcrumb}} as |item|>
        <button 
          type="button" 
          class="upper link is-sub" 
          disabled={{@disabled}} 
          {{on "click" (fn (mut this.sourcePath) item.path)}}
        >
          {{item.name}}
        </button>
      </DenaliBreadcrumb>
      <h4 class="report-builder-sidebar__source flex-1 {{if (eq this.sourcePath.length 0) "p-l-20" "p-l-6"}}" data-selecting={{this.selecting}}>{{this.title}}</h4>
    </div>
  </div>
  {{#if (eq this.selecting "dataSource")}}
    <ReportBuilder::SourceSelector
      class="report-builder-sidebar__content report-builder-source-selector--datasources"
      @currentSource={{this.requestDataSource}}
      @sources={{this.dataSources}}
      @setSource={{this.setSelectedDataSource}}
    />
  {{else if (eq this.selecting "table")}}
    <ReportBuilder::SourceSelector
      class="report-builder-sidebar__content report-builder-source-selector--tables"
      @currentSource={{this.requestTableMetadata}}
      @sources={{this.dataSourceTables}}
      @setSource={{this.setSelectedTable}}
    />
  {{else}}
    <div class="report-builder-sidebar__content flex-1 row">
      <div class="report-builder-sidebar__columns flex-1">
        <div class="report-builder__container--builder">
          <div class="report-builder__container report-builder__dimension-selector {{if @disabled "report-builder__container--disabled"}}">
            <ColumnSelector
              @title="Dimensions"
              @allColumns={{append this.request.tableMetadata.dimensions this.request.tableMetadata.timeDimensions}}
              @request={{this.request}}
              @onAddColumn={{queue (optional @onBeforeAddItem) (update-report-action "ADD_COLUMN_WITH_PARAMS")}}
              @onAddFilter={{queue (update-report-action "ADD_DIMENSION_FILTER") @openFilters}}
            />
          </div>
          <div class="report-builder__container report-builder__metric-selector{{if @disabled " report-builder__container--disabled"}}" >
            <ColumnSelector
              @title="Metrics"
              @allColumns={{this.request.tableMetadata.metrics}}
              @request={{this.request}}
              @onAddColumn={{queue (optional @onBeforeAddItem) (update-report-action "ADD_COLUMN_WITH_PARAMS")}}
              @onAddFilter={{queue (update-report-action "ADD_METRIC_FILTER") @openFilters}}
            />
          </div>
        </div>
      </div>

      <NaviColumnConfig
        class="flex-1 {{if @disabled "navi-column-config--disabled"}}"
        @isOpen={{true}}
        @lastAddedColumn={{@lastAddedColumn}}
        @report={{@report}}
        @openFilters={{route-action "openFilters"}}
        @onAddColumn={{update-report-action "ADD_COLUMN_WITH_PARAMS"}}
        @onRemoveColumn={{update-report-action "REMOVE_COLUMN_FRAGMENT"}}
        @onAddFilter={{update-report-action "ADD_FILTER"}}
        @onUpsertSort={{update-report-action "UPSERT_SORT"}}
        @onRemoveSort={{update-report-action "REMOVE_SORT"}}
        @onRenameColumn={{update-report-action "RENAME_COLUMN_FRAGMENT"}}
        @onReorderColumn={{update-report-action "REORDER_COLUMN_FRAGMENT"}}
        @onUpdateColumnParam={{update-report-action "UPDATE_COLUMN_FRAGMENT_WITH_PARAMS"}}
      />
    </div>
  {{/if}}
</div>