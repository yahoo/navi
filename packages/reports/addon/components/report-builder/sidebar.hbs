{{!-- Copyright 2021, Yahoo Holdings Inc. Licensed under the terms of the MIT license. See accompanying LICENSE.md file for terms. --}}
<div class="report-builder-sidebar column">
  <div class="report-builder-sidebar__header row p-l-18 p-y-7 align-items-center">
    <div>
      <DenaliBreadcrumb class="report-builder-sidebar__breadcrumb flex-1 font-12" @items={{this.breadcrumb}} as |item|>
        <button 
          type="button" 
          class="report-builder-sidebar__breadcrumb-item upper link is-sub" 
          disabled={{@disabled}} 
          data-level={{item.path.length}}
          {{on "click" (fn (mut this.sourcePath) item.path)}}
        >
          {{item.name}}
        </button>
      </DenaliBreadcrumb>
      <h4 class="report-builder-sidebar__source flex-1 p-l-6" data-selecting={{this.selecting}}>{{this.title}}</h4>
    </div>
  </div>
  {{#if (eq this.selecting "dataSource")}}
    <ReportBuilder::SourceSelector
      class="report-builder-sidebar__content report-builder-source-selector--datasources"
      @currentSource={{this.requestDataSource}}
      @sources={{this.dataSources}}
      @setSource={{this.setSelectedDataSource}}
    />
  {{else if (eq this.selecting "table")}}
    <ReportBuilder::SourceSelector
      class="report-builder-sidebar__content report-builder-source-selector--tables"
      @currentSource={{this.requestTableMetadata}}
      @sources={{this.dataSourceTables}}
      @setSource={{this.setSelectedTable}}
    />
  {{else}}
    <div class="report-builder-sidebar__content flex-1 row">
      <div class="report-builder-sidebar__columns">
        <div class="report-builder__dimension-selector {{if @disabled "report-builder__container--disabled"}}">
          <ColumnSelector
            @title="Dimensions"
            @allColumns={{compact (append this.request.tableMetadata.dimensions this.request.tableMetadata.timeDimensions)}}
            @request={{this.request}}
            @onAddColumn={{queue (optional @onBeforeAddItem) (update-report-action "ADD_COLUMN_WITH_PARAMS")}}
            @onAddFilter={{queue (update-report-action "ADD_DIMENSION_FILTER") @openFilters}}
          />
        </div>
        <hr class="report-builder-sidebar__separator" />
        <div class="report-builder__metric-selector{{if @disabled " report-builder__container--disabled"}}" >
          <ColumnSelector
            @title="Metrics"
            @allColumns={{or this.request.tableMetadata.metrics (array)}}
            @request={{this.request}}
            @onAddColumn={{queue (optional @onBeforeAddItem) (update-report-action "ADD_COLUMN_WITH_PARAMS")}}
            @onAddFilter={{queue (update-report-action "ADD_METRIC_FILTER") @openFilters}}
          />
        </div>
      </div>

      <NaviColumnConfig
        class="flex-1 {{if @disabled "navi-column-config--disabled"}}"
        @isOpen={{true}}
        @lastAddedColumn={{@lastAddedColumn}}
        @report={{@report}}
        @openFilters={{route-action "openFilters"}}
        @onAddColumn={{update-report-action "ADD_COLUMN_WITH_PARAMS"}}
        @onRemoveColumn={{update-report-action "REMOVE_COLUMN_FRAGMENT"}}
        @onAddFilter={{update-report-action "ADD_FILTER"}}
        @onUpsertSort={{update-report-action "UPSERT_SORT"}}
        @onRemoveSort={{update-report-action "REMOVE_SORT"}}
        @onRenameColumn={{update-report-action "RENAME_COLUMN_FRAGMENT"}}
        @onReorderColumn={{update-report-action "REORDER_COLUMN_FRAGMENT"}}
        @onUpdateColumnParam={{update-report-action "UPDATE_COLUMN_FRAGMENT_WITH_PARAMS"}}
      />
    </div>
  {{/if}}
</div>